<%=render "layouts/admin_header"%>

<div class="container">
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-11">
            <div class="row mt-5">
                <h1>サウナ施設の投稿</h1>
            </div>
            <div class="row mt-3">
                <div class="col-auto alert alert-danger">
                現在、サウナ室の温度と水風呂の温度が入力されていない場合でも施設を作成できてしまうバグが発生中です。<br>
                必要項目すべてに回答したかどうか確認した上で投稿ボタンを押してください。
                </div>
            </div>

            <div class="row my-3">
                <% if @sauna.errors.any? %>
                    <div class="row mt-5">
                        <h1><%= @sauna.errors.count %>件のエラーが発生しました</h1>
                        <ul>
                            <% @sauna.errors.full_messages.each do |message| %>
                                <li class="fs-5"><%= message %></li>
                            <% end %>
                        </ul>
                    </div>
                <% end %>
            </div>

            <div class="row mt-5">
                <%=form_with model: @sauna, url: admin_saunas_path, data: { turbo: false }, method: :post do |f|%>
                    <div class="col-md-5">
                        <h4>サウナ施設名前</h4>
                        <%=f.text_field :name, class: "form-control"%>
                    </div>
                    <div class="col-md-5 mt-4">
                        <h4>住所</h4>
                        <%=f.text_field :address, class: "form-control"%>
                    </div>

                    <div class="mt-4 col-md-5">
                        <h4>写真(1枚のみ)</h4>
                        <%= f.file_field :image, accept: "image/*", class: "form-control" %>
                    </div>

                    <div class="mt-4 col-md-5">
                        <h4>サウナ施設の説明</h4>
                        <%= f.text_area :express, class: "form-control", :size=>"60x10" %>
                    </div>
                    
                    <div id="number_saunas">
                        <%= f.fields_for :number_saunas, data: { turbo: false } do |sauna_f| %>
                            <div class="number_sauna"  style="display: <%= 'none' if @sauna.new_record?%>;">
                                <div class="col-md-5 mt-4">
                                    <h4>サウナ室の温度</h4>
                                    <%=sauna_f.collection_select :sauna_info_id, @sauna_infos, :id, :temperature, {include_blank: "選択してください"}, class: "form-select"%>
                                </div>
                            </div> 
                        <%end%>    
                            <div class="col-md-auto">
                                <div class="mt-3">
                                    <button id="add-sauna-button" type="button" class="btn">サウナ室の追加はこちらから</button>
                                    サウナ施設は最大10個まで追加可能
                                    <button id="hide-sauna-button" type="button" class="btn btn-secondary"><i class="fa-sharp fa-solid fa-minus"></i></button>
                                </div>
                            </div>
                    </div>
                    <div id="number_waters">
                        <%= f.fields_for :number_waters, data: { turbo: false } do |water_f| %>
                            <div class="number_water" style="display: <%= 'none' if @sauna.new_record?%>;">
                                <div class="col-md-5 mt-4">
                                    <h4>水風呂の温度</h4>
                                    <%=water_f.collection_select :water_id, @water, :id, :temperature, {include_blank: "選択してください"}, class: "form-select"%>
                                </div>
                            </div>
                        <%end%>
                        <div class="col-md-auto">
                            <div class="mt-3">
                                <button id="add-water-button" type="button" class="btn">水風呂の追加はこちらから</button>
                                水風呂は最大10個まで追加可能
                                <button id="hide-water-button" type="button" class="btn btn-secondary"><i class="fa-sharp fa-solid fa-minus"></i></button>
                            </div>
                        </div>
                    </div>

                    <%=f.submit "投稿する", class: "btn btn-primary mt-5" %>
                <%end%>
            </div>
            <% if @sauna.errors.any? %>
                <%= javascript_pack_tag 'admin/saunas/render' %>
            <%end%>

        </div>
    </div>
</div>

<script>
//サウナ室の場合
document.addEventListener("turbo:load", function() {
  document.getElementById("add-sauna-button").addEventListener("click", function() {
    var container = document.getElementById("number_saunas");
    var numberSaunas = container.getElementsByClassName("number_sauna");
    
    //非表示のフォームを表示するため
    for (var i = 0; i < numberSaunas.length; i++) {
      if (numberSaunas[i].style.display === "none") {
        numberSaunas[i].style.display = "flex";
        break;
      }
    }
  });
  document.getElementById("hide-sauna-button").addEventListener("click", function() {
    var container = document.getElementById("number_saunas");
    var numberSaunas = container.getElementsByClassName("number_sauna");
    
    //表示されているフォームを非表示にするため
    for (var i = 0; i < numberSaunas.length; i++) {
      if (numberSaunas[i].style.display !== "none") {
        numberSaunas[i].style.display = "none";
        break;
      }
    }
  });
});
//水風呂の場合
document.addEventListener("turbo:load", function() {
  document.getElementById("add-water-button").addEventListener("click", function() {
    var container = document.getElementById("number_waters");
    var numberWaters = container.getElementsByClassName("number_water");
    
    //非表示のフォームを表示するため
    for (var i = 0; i < numberWaters.length; i++) {
      if (numberWaters[i].style.display === "none") {
        numberWaters[i].style.display = "flex";
        break;
      }
    }
  });
  document.getElementById("hide-water-button").addEventListener("click", function() {
    var container = document.getElementById("number_waters");
    var numberWaters = container.getElementsByClassName("number_water");
    
    //表示されているフォームを非表示にするため
    for (var i = 0; i < numberWaters.length; i++) {
      if (numberWaters[i].style.display !== "none") {
        numberWaters[i].style.display = "none";
        break;
      }
    }
  });
});
</script>